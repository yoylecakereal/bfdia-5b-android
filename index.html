<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BFDIA 5b</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!-- Load local Ruffle build placed next to this HTML (ruffle.js) -->
  <script src="ruffle.js"></script>
  <style>
    /* Make the page and ruffle player fill the entire viewport */
    html, body {
      height: 100%;
      margin: 0;
      background: #000;
    }

    /* Full-viewport fixed container so the player always fills the page */
    #game {
      position: fixed;
      inset: 0; /* top:0; right:0; bottom:0; left:0; */
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    /* Ensure the ruffle player and its inner canvas expand to fill the container.
       This sets the player to cover the full viewport. If you prefer letterboxing
       to preserve the original SWF aspect ratio, change these rules to use
       `max-width` / `max-height` and `width: auto; height: auto;` instead. */
    #game ruffle-player,
    #game object,
    #game embed,
    #game canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>
</head>
<body>
  <!-- Container for the SWF -->
  <div id="game"></div>

  <!-- Mobile controls (always visible) - updated layout matching screenshot -->
  <div id="mobile-controls" aria-hidden="false">
    <!-- Left D-Pad: up above, left and right below -->
    <div class="controls-left">
      <div class="dpad" role="group" aria-label="D-Pad">
        <button class="btn d-up" aria-hidden="true" style="visibility:hidden;">▲</button>

        <button class="btn d-left" data-key="ArrowLeft" data-keycode="37" aria-label="Left">◀</button>
        <button class="btn d-right" data-key="ArrowRight" data-keycode="39" aria-label="Right">▶</button>
      </div>
    </div>

    <!-- Right-side actions: Enter top-right, Z/R bottom-right -->
    <div class="controls-right">
      <button id="enter-btn" class="btn enter-top" data-key="Enter" data-keycode="13" aria-label="Confirm">Enter</button>

      <div class="actions-bottom">
        <button class="btn action large jump" data-key=" " data-keycode="32" aria-label="Jump">▲</button>
        <button class="btn action large" data-key="z" data-keycode="90" aria-label="Swap">Z</button>
        <button class="btn action large" data-key="r" data-keycode="82" aria-label="Reset">R</button>
      </div>
    </div>
  </div>

  <script>
    // Initialize Ruffle from local `ruffle.js` and wire controls/fullscreen.
    function initRuffleAndControls() {
      if (!(window.RufflePlayer && typeof window.RufflePlayer.newest === 'function')) {
        console.error('Ruffle not found. Make sure `ruffle.js` is placed next to this HTML file.');
        return;
      }

      const ruffle = window.RufflePlayer.newest();
      const player = ruffle.createPlayer();
      document.getElementById("game").appendChild(player);

      // Load the SWF file (must be in same folder as HTML)
      player.load("5b.swf");
      if (player && player.style) {
        player.style.width = '100%';
        player.style.height = '100%';
        player.style.display = 'block';
      }

      function toggleFullscreen(elem) {
        const doc = document;
        const isFull = doc.fullscreenElement || doc.webkitFullscreenElement || doc.msFullscreenElement;
        if (!isFull) {
          if (elem.requestFullscreen) elem.requestFullscreen();
          else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
          else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
        } else {
          if (doc.exitFullscreen) doc.exitFullscreen();
          else if (doc.webkitExitFullscreen) doc.webkitExitFullscreen();
          else if (doc.msExitFullscreen) doc.msExitFullscreen();
        }
      }

      document.addEventListener('keydown', function (e) {
        const isF11 = (e.key === 'F11') || (e.keyCode === 122);
        if (isF11) {
          e.preventDefault();
          const container = document.getElementById('game') || document.documentElement;
          toggleFullscreen(container);
        }
      });

      (function () {
        const controls = document.getElementById('mobile-controls');
        if (!controls) return;

        function sendKey(type, key, keyCode, code) {
          const eventInit = { key: key, code: code || key, keyCode: keyCode, which: keyCode, bubbles: true, cancelable: true };
          let ev;
          try { ev = new KeyboardEvent(type, eventInit); }
          catch (err) { ev = document.createEvent('KeyboardEvent'); ev.initKeyboardEvent(type, true, true, window, key, 0, '', false, ''); }
          if (player && typeof player.dispatchEvent === 'function') player.dispatchEvent(ev);
          window.dispatchEvent(ev);
        }

        function bindButton(btn) {
          const key = btn.getAttribute('data-key');
          const keyCode = parseInt(btn.getAttribute('data-keycode'), 10) || 0;
          const code = btn.getAttribute('data-code') || key;
          function onPress(e) { e.preventDefault(); btn.classList.add('active'); sendKey('keydown', key, keyCode, code); }
          function onRelease(e) { e && e.preventDefault(); btn.classList.remove('active'); sendKey('keyup', key, keyCode, code); }
          btn.addEventListener('touchstart', onPress, {passive:false}); btn.addEventListener('mousedown', onPress);
          btn.addEventListener('touchend', onRelease); btn.addEventListener('touchcancel', onRelease); btn.addEventListener('mouseup', onRelease); btn.addEventListener('mouseleave', onRelease);
        }

        const buttons = controls.querySelectorAll('.btn');
        buttons.forEach(bindButton);
      })();
    }

    // Local script should load synchronously; initialize immediately.
    initRuffleAndControls();
  </script>

  <style>
    /* No offline overlay — using local `ruffle.js` placed next to this HTML */
    /* Mobile controls styling - black, bold, screenshot-like layout */
    #mobile-controls { position: fixed; inset: auto 12px 12px 12px; z-index: 9999; pointer-events: auto; }
    /* Move D-pad up so it does not overlap on-screen level text */
    .controls-left { position: fixed; left: 18px; bottom: 84px; }
    .controls-right { position: fixed; right: 12px; top: 12px; bottom: 12px; pointer-events: none; }

    /* D-pad arranged with up button above left/right */
    .dpad { display: grid; grid-template-areas: "up up up" "left center right"; grid-template-columns: 64px 64px 64px; grid-auto-rows: 64px; gap: 8px; align-items: center; }
    .d-up { grid-area: up; }
    .d-left { grid-area: left; }
    .d-center { grid-area: center; }
    .d-right { grid-area: right; }

    /* Base button style */
    .btn { background: #000; color: #fff; border: 2px solid rgba(255,255,255,0.95); border-radius: 8px; width: 64px; height: 64px; font-size: 26px; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 10px rgba(0,0,0,0.6); pointer-events: auto; }
    .btn:focus { outline: 2px solid rgba(255,255,255,0.18); }
    .btn.large { width: 88px; height: 88px; font-size: 34px; border-radius: 10px; }
    .enter-top { position: fixed; top: 12px; right: 12px; width: 140px; height: 84px; font-size: 44px; border-radius: 12px; pointer-events: auto; }
    .actions-bottom { position: fixed; right: 18px; bottom: 96px; display:flex; gap: 12px; pointer-events: auto; flex-direction: row-reverse; align-items: flex-end; }

    .btn:active, .btn.active { transform: scale(0.96); background: rgba(255,255,255,0.06); }

    /* Keep the jump button on the far right and nudge Z/R out of its way */
    /* Raised further to avoid overlapping top/right menu controls */
    .actions-bottom .action { transform: translateY(-12px); }
    .btn.jump { width: 88px; height: 88px; font-size: 34px; border-radius: 10px; }

    @media (min-width: 900px) {
      /* On large screens keep controls visible but smaller */
      .btn { width:56px; height:56px; font-size:18px; }
      .btn.large { width:64px; height:64px; font-size:22px; }
      .enter-top { width:96px; height:56px; font-size:20px; }
    }
  </style>
</body>
</html>
